---
import Layout from "../../Layouts/Layout.astro";
import { PermissionsDropdown } from "../../components/jsx/PermissionsDropdown";
import { CoursesDropdown } from "../../components/jsx/CoursesDropdown";
import { checkUserRole } from "../api/auth/roleBasedRedirect";
import ProfileImageUpload from "../../components/jsx/ProfileImageUpload";

// Datos simulados
const adminProfile = {
  profileImage: "https://i.pinimg.com/enabled_hi/564x/58/6b/55/586b55d9f9d97556849e19d6018a5219.jpg",
  permissions: [
    { id: "editProfiles", label: "Puede editar perfiles", checked: false },
    { id: "editCourses", label: "Puede editar cursos", checked: false },
    { id: "beNominator", label: "Puede ser nominador", checked: false },
    { id: "seeOwnCourses", label: "Puede ver sus propios cursos", checked: false },
    { id: "seeAllCourses", label: "Puede ver todos los cursos", checked: false },
  ],
  courses: [
    { id: 1, name: "Curso de algo", action: "Inscripci칩n" },
    { id: 2, name: "Curso de algo", action: "Descargar certificado" },
    { id: 3, name: "Curso de algo", action: "Descargar certificado" },
  ]
};  

const allowedRoles = ["admin"];

const userData = await checkUserRole(Astro, ["admin"]);

if (!userData || !allowedRoles.includes(userData.role)) {
  return Astro.redirect("/signin"); 
}
---

<Layout title="Perfil de administrador">
  <div class="max-w-6xl mx-auto p-4 md:p-8 mb-auto">
    <h1 class="text-4xl text-customBlack font-bold uppercase mb-16">{userData.name}</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="md:col-span-1">
        <ProfileImageUpload initialImageUrl={userData.profileImage || adminProfile.profileImage} client:load />
      </div>
      
      <div class="md:col-span-2">
        <div class="mb-6">
          <PermissionsDropdown permissions={adminProfile.permissions} client:load />
        </div>

        <form class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
          <div>
            <label for="nombres" class="block text-sm font-medium text-gray-700">Nombres</label>
            <input 
              type="text" 
              id="nombres" 
              name="nombres" 
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm bg-gray-100 text-gray-500 px-4 py-2 cursor-not-allowed" 
              value={userData.name} 
              readonly 
            />
          </div>

          <div>
            <label for="apellidos" class="block text-sm font-medium text-gray-700">Apellidos</label>
            <input 
              type="text" 
              id="apellidos" 
              name="apellidos" 
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm bg-gray-100 text-gray-500 px-4 py-2 cursor-not-allowed" 
              value={userData.lastName} 
              readonly 
            />
          </div>

          <div>
            <label for="email" class="block text-sm font-medium text-gray-700">Correo Electr칩nico</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm bg-gray-100 text-gray-500 px-4 py-2 cursor-not-allowed" 
              value={userData.email} 
              readonly 
            />
          </div>

          <div>
            <label for="password" class="block text-sm font-medium text-gray-700">Contrase침a</label>
            <input 
              type="password" 
              id="password" 
              name="password" 
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm bg-gray-100 text-gray-500 px-4 py-2 cursor-not-allowed" 
              value="********" 
              readonly 
            />
          </div>

          <div>
            <label for="direccion" class="block text-sm font-medium text-gray-700">Direcci칩n</label>
            <input 
              type="text" 
              id="direccion" 
              name="direccion" 
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm bg-gray-100 text-gray-500 px-4 py-2 cursor-not-allowed" 
              value={userData.address} 
              readonly 
            />
          </div>

          <div>
            <label for="dni" class="block text-sm font-medium text-gray-700">DNI</label>
            <input 
              type="text" 
              id="dni" 
              name="dni" 
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm bg-gray-100 text-gray-500 px-4 py-2 cursor-not-allowed" 
              value={userData.dni} 
              readonly 
            />
          </div>
        </form>

        <div>
          <CoursesDropdown courses={adminProfile.courses} client:load />
        </div>
      </div>
    </div>
  </div>
</Layout>